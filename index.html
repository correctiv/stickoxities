---
---
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Stickoxide</title>
    <meta name="viewport" content="initial-scale=1" />
    <link rel="stylesheet" href="static/js/vendor/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="static/css/main.css">
</head>
<body>

<div class="cities">
{% for city in site.data.cities %}
<div class="city" id="{{ city.id }}">
  <h3>{{ city.name }}</h3>
  <div class="city-map">
  </div>
  <div class="city-sparkline"></div>
</div>
{% endfor %}
</div>

<script src="static/js/vendor/leaflet/dist/leaflet.js"></script>
<script src="static/js/vendor/d3/d3.min.js"></script>
<script src="static/js/geomultiples.js" charset="utf-8"></script>
<script>

var dispatcher = d3.dispatch("datechangeRequest", "datechange");
var cities = {{ site.data.cities|jsonify }};
var umweltzonen = {{ site.data.umweltzonen|jsonify }};
var stickoxide = {{ site.data.stickoxide|jsonify }};
cities.forEach(function(city){
  var uz = umweltzonen.features.filter(function(f, i){
    if (f.properties.city === city.id) {
      return true;
    }
    return false;
  })
  city.umweltzone = uz[0];
  city.stickoxide = stickoxide[city.id];
  city.dispatcher = dispatcher;
  new GeoMultiple(document.getElementById(city.id), city);
});

requestedAnimationFrame = null;
dispatcher.on("datechangeRequest", function(date) {
  if (requestedAnimationFrame) {
    window.cancelAnimationFrame(requestedAnimationFrame);
  }
  requestedAnimationFrame = window.requestAnimationFrame((function(date, fr){
    return function() {
      requestedAnimationFrame = null;
      dispatcher.datechange(date);
    };
  }(date, requestedAnimationFrame)));
});


</script>
</body>
</html>
